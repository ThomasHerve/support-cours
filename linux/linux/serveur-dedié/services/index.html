
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>Linux - Sécurisation des Services avec Fail2ban et PortSentry - Cours DevOps et Linux</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#linux-securisation-des-services-avec-fail2ban-et-portsentry" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Cours DevOps et Linux" class="md-header__button md-logo" aria-label="Cours DevOps et Linux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 22v-2h3v-3h2v3.5c0 .39-.16.74-.46 1.04s-.65.46-1.04.46zM7 22H3.5c-.39 0-.74-.16-1.04-.46S2 20.89 2 20.5V17h2v3h3zM17 2h3.5c.39 0 .74.16 1.04.46s.46.65.46 1.04V7h-2V4h-3zM7 2v2H4v3H2V3.5c0-.39.16-.74.46-1.04S3.11 2 3.5 2zm6 15.25 4-2.3v-4.59l-4 2.3zm-1-6.33 4-2.29-4-2.35-4 2.35zm-5 4.03 4 2.3v-4.59l-4-2.3zm11.23-7.36c.5.32.77.75.77 1.32v6.32c0 .57-.27 1-.77 1.32l-5.48 3.18q-.75.48-1.5 0l-5.48-3.18c-.5-.32-.77-.75-.77-1.32V8.91c0-.57.27-1 .77-1.32l5.48-3.18c.25-.13.5-.19.75-.19s.5.06.75.19z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cours DevOps et Linux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Linux - Sécurisation des Services avec Fail2ban et PortSentry
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../docker/" class="md-tabs__link">
          
  
    
  
  Docker

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Cours DevOps et Linux" class="md-nav__button md-logo" aria-label="Cours DevOps et Linux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 22v-2h3v-3h2v3.5c0 .39-.16.74-.46 1.04s-.65.46-1.04.46zM7 22H3.5c-.39 0-.74-.16-1.04-.46S2 20.89 2 20.5V17h2v3h3zM17 2h3.5c.39 0 .74.16 1.04.46s.46.65.46 1.04V7h-2V4h-3zM7 2v2H4v3H2V3.5c0-.39.16-.74.46-1.04S3.11 2 3.5 2zm6 15.25 4-2.3v-4.59l-4 2.3zm-1-6.33 4-2.29-4-2.35-4 2.35zm-5 4.03 4 2.3v-4.59l-4-2.3zm11.23-7.36c.5.32.77.75.77 1.32v6.32c0 .57-.27 1-.77 1.32l-5.48 3.18q-.75.48-1.5 0l-5.48-3.18c-.5-.32-.77-.75-.77-1.32V8.91c0-.57.27-1 .77-1.32l5.48-3.18c.25-.13.5-.19.75-.19s.5.06.75.19z"/></svg>

    </a>
    Cours DevOps et Linux
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../docker/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pourquoi-utiliser-fail2ban-et-portsentry" class="md-nav__link">
    <span class="md-ellipsis">
      Pourquoi utiliser Fail2ban et PortSentry ?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pourquoi utiliser Fail2ban et PortSentry ?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Fail2ban
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fail2ban">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avantages-de-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Avantages de Fail2ban :
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#portsentry" class="md-nav__link">
    <span class="md-ellipsis">
      PortSentry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PortSentry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avantages-de-portsentry" class="md-nav__link">
    <span class="md-ellipsis">
      Avantages de PortSentry :
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partie-1-installation-et-configuration-de-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Partie 1 : Installation et Configuration de Fail2ban
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Partie 1 : Installation et Configuration de Fail2ban">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etape-11-installation-de-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Étape 1.1 : Installation de Fail2ban
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-12-configurer-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Étape 1.2 : Configurer Fail2ban
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-13-tester-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Étape 1.3 : Tester Fail2ban
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partie-2-installation-et-configuration-de-portsentry" class="md-nav__link">
    <span class="md-ellipsis">
      Partie 2 : Installation et Configuration de PortSentry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Partie 2 : Installation et Configuration de PortSentry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etape-21-installation-de-portsentry" class="md-nav__link">
    <span class="md-ellipsis">
      Étape 2.1 : Installation de PortSentry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-22-configurer-portsentry" class="md-nav__link">
    <span class="md-ellipsis">
      Étape 2.2 : Configurer PortSentry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-23-tester-portsentry" class="md-nav__link">
    <span class="md-ellipsis">
      Étape 2.3 : Tester PortSentry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-24-debannir-une-ip-dans-portsentry" class="md-nav__link">
    <span class="md-ellipsis">
      Étape 2.4 : Débannir une IP dans PortSentry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="linux-securisation-des-services-avec-fail2ban-et-portsentry">Linux - Sécurisation des Services avec Fail2ban et PortSentry</h1>
<p><img alt="Tutorial Cover" src="../assets/fail2ban-logo.jpg" /></p>
<h2 id="introduction">Introduction</h2>
<p>La sécurité des serveurs est essentielle dans un environnement connecté. <strong>Fail2ban</strong> et <strong>PortSentry</strong> sont deux outils complémentaires permettant de renforcer la défense contre les attaques courantes. Ce guide explique leur rôle, leur fonctionnement et leur configuration.</p>
<hr />
<h2 id="pourquoi-utiliser-fail2ban-et-portsentry">Pourquoi utiliser Fail2ban et PortSentry ?</h2>
<h3 id="fail2ban">Fail2ban</h3>
<p>Fail2ban surveille les journaux de votre serveur pour détecter des comportements suspects comme des tentatives répétées de connexion (attaques par force brute). Lorsqu'une activité malveillante est détectée, Fail2ban bloque temporairement l'IP fautive en configurant automatiquement le pare-feu.</p>
<h4 id="avantages-de-fail2ban"><strong>Avantages de Fail2ban</strong> :</h4>
<ul>
<li>Protège les services spécifiques (ex. SSH, HTTP, FTP).</li>
<li>Réduit les risques d'accès non autorisés par force brute.</li>
<li>Flexible grâce à ses filtres personnalisables.</li>
</ul>
<hr />
<h3 id="portsentry">PortSentry</h3>
<p>PortSentry est conçu pour détecter les scans de ports, une technique utilisée par les attaquants pour identifier les services actifs sur un serveur. Lorsqu'un scan est détecté, PortSentry bloque immédiatement l'IP suspecte via le pare-feu ou d'autres méthodes.</p>
<h4 id="avantages-de-portsentry"><strong>Avantages de PortSentry</strong> :</h4>
<ul>
<li>Détecte et bloque les attaques en amont.</li>
<li>Complète Fail2ban en sécurisant les services "non exposés".</li>
<li>Agit en mode préventif contre les tentatives de reconnaissance.</li>
</ul>
<hr />
<h2 id="partie-1-installation-et-configuration-de-fail2ban">Partie 1 : Installation et Configuration de Fail2ban</h2>
<h3 id="etape-11-installation-de-fail2ban">Étape 1.1 : Installation de Fail2ban</h3>
<ol>
<li>
<p><strong>Installer Fail2ban</strong> :<br />
   Utilisez le gestionnaire de paquets de votre distribution :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Ubuntu/Debian</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>fail2ban
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># CentOS/RedHat</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>fail2ban
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># SUSE</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>fail2ban
</span></code></pre></div></p>
</li>
<li>
<p><strong>Vérifiez que Fail2ban est installé et actif</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>fail2ban
</span></code></pre></div></p>
</li>
</ol>
<p>Pour WSL</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>service<span class="w"> </span>fail2ban<span class="w"> </span>status
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>sudo<span class="w"> </span>service<span class="w"> </span>fail2ban<span class="w"> </span>start
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>sudo<span class="w"> </span>service<span class="w"> </span>fail2ban<span class="w"> </span>status
</span></code></pre></div>
<hr />
<h3 id="etape-12-configurer-fail2ban">Étape 1.2 : Configurer Fail2ban</h3>
<p>Fail2ban utilise des <strong>jails</strong> (prisons) pour définir des règles spécifiques à chaque service.</p>
<ol>
<li>
<p><strong>Créer un fichier de configuration local</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>cp<span class="w"> </span>/etc/fail2ban/jail.conf<span class="w"> </span>/etc/fail2ban/jail.local
</span></code></pre></div></p>
</li>
<li>
<p><strong>Configurer les options générales</strong> :<br />
   - Ouvrez le fichier <code>/etc/fail2ban/jail.local</code> :
     <div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/fail2ban/jail.local
</span></code></pre></div>
   - Modifiez les paramètres principaux :
     <div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>bantime = 1m             # Durée du bannissement
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>maxretry = 3               # Nombre de tentatives avant le bannissement
</span></code></pre></div></p>
</li>
<li>
<p><strong>Activer la protection pour SSH</strong> :
   Recherchez la section <code>[sshd]</code> et configurez-la ainsi :
   <div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>[sshd]
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>enabled = true
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>port = ssh
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>logpath = /var/log/auth.log
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>maxretry = 3
</span></code></pre></div></p>
</li>
<li>
<p><strong>Créer le fichier de logs</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>sudo<span class="w"> </span>touch<span class="w"> </span>/var/log/auth.log
</span></code></pre></div></p>
</li>
</ol>
<hr />
<h3 id="etape-13-tester-fail2ban">Étape 1.3 : Tester Fail2ban</h3>
<ol>
<li>
<p><strong>Redémarrez Fail2ban pour appliquer les modifications</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>fail2ban
</span></code></pre></div>
Pour WSL
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>sudo<span class="w"> </span>service<span class="w"> </span>fail2ban<span class="w"> </span>restart<span class="w"> </span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Simulez une attaque par force brute sur SSH</strong> :<br />
   - Essayez de vous connecter avec un mot de passe incorrect :
     <div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ssh<span class="w"> </span>invalid_user@localhost
</span></code></pre></div>
   - Après plusieurs tentatives échouées (selon <code>maxretry</code>), votre IP sera bannie.
   - Selon votre système (surtout WSL...) cela peut ne ps fonctionner. Dans ce cas là passez à PortSentry.</p>
</li>
<li>
<p><strong>Vérifiez les IP bannies</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>sudo<span class="w"> </span>fail2ban-client<span class="w"> </span>status<span class="w"> </span>sshd
</span></code></pre></div></p>
</li>
<li>
<p><strong>Débannir une IP (si nécessaire)</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>sudo<span class="w"> </span>fail2ban-client<span class="w"> </span>unban<span class="w"> </span>&lt;IP&gt;
</span></code></pre></div></p>
</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Si vous vous bannissez par erreur, utilisez une autre session pour débannir votre IP.</p>
</div>
<hr />
<h2 id="partie-2-installation-et-configuration-de-portsentry">Partie 2 : Installation et Configuration de PortSentry</h2>
<h3 id="etape-21-installation-de-portsentry">Étape 2.1 : Installation de PortSentry</h3>
<ol>
<li>
<p><strong>Installer PortSentry</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Ubuntu/Debian</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>portsentry
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="c1"># CentOS/RedHat (via EPEL)</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>portsentry
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="c1"># SUSE</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>portsentry
</span></code></pre></div></p>
</li>
<li>
<p><strong>Vérifiez l’installation</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo<span class="w"> </span>portsentry<span class="w"> </span>-version
</span></code></pre></div></p>
</li>
</ol>
<hr />
<h3 id="etape-22-configurer-portsentry">Étape 2.2 : Configurer PortSentry</h3>
<ol>
<li>
<p><strong>Modifier le fichier de configuration principal</strong> :<br />
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/portsentry/portsentry.conf
</span></code></pre></div></p>
</li>
<li>
<p><strong>Configurer les ports surveillés</strong> :<br />
   Modifiez ou ajoutez une liste personnalisée de ports :
   <div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>TCP_PORTS=&quot;1,11,15,23,79,81,443,1080&quot;
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>UDP_PORTS=&quot;1,7,9,69,135,137,161,500&quot;
</span></code></pre></div></p>
</li>
<li>
<p><strong>Activer le mode Stealth</strong> :<br />
   Le mode Stealth détecte les scans furtifs et réagit en bloquant l'IP :
   <div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>BLOCK_UDP=&quot;1&quot;
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>BLOCK_TCP=&quot;1&quot;
</span></code></pre></div></p>
</li>
<li>
<p><strong>Permettre le blocage de localhost pour les besoins du tp</strong>
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/portsentry/portsentry.ignore
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/portsentry/portsentry.ignore.static
</span></code></pre></div>
   Supprimez les lignes de ces fichiers.</p>
</li>
</ol>
<hr />
<h3 id="etape-23-tester-portsentry">Étape 2.3 : Tester PortSentry</h3>
<ol>
<li>
<p><strong>Démarrez PortSentry</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>sudo<span class="w"> </span>service<span class="w"> </span>portsentry<span class="w"> </span>start<span class="w"> </span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Simulez une tentative de scan de port</strong> :<br />
   Utilisez <code>nmap</code> pour scanner les ports :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>nmap<span class="w"> </span>localhost
</span></code></pre></div></p>
</li>
<li>
<p>Si PortSentry est actif, il détectera le scan et bloquera l'IP.</p>
</li>
<li>
<p><strong>Vérifiez les règles iptables ajoutées</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>sudo<span class="w"> </span>iptables<span class="w"> </span>-L<span class="w"> </span>-v
</span></code></pre></div>
   Cela ne fonctionne pas sur tout les systèmes, WSL en tête. vous pouvez néanmoins vérifier que le scan a été détecté de cette manière:
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="w"> </span>sudo<span class="w"> </span>cat<span class="w"> </span>/etc/hosts.deny
</span></code></pre></div></p>
</li>
</ol>
<hr />
<h3 id="etape-24-debannir-une-ip-dans-portsentry">Étape 2.4 : Débannir une IP dans PortSentry</h3>
<p>Lorsque PortSentry bannit une IP, elle est ajoutée aux règles iptables ou au fichier <code>hosts.deny</code>.</p>
<ol>
<li>
<p><strong>Débannir une IP dans iptables</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>sudo<span class="w"> </span>iptables<span class="w"> </span>-D<span class="w"> </span>INPUT<span class="w"> </span>-s<span class="w"> </span>&lt;IP_BANNEE&gt;<span class="w"> </span>-j<span class="w"> </span>DROP
</span></code></pre></div></p>
</li>
<li>
<p><strong>Supprimer une IP bannie dans <code>/etc/hosts.deny</code></strong> (si configuré) :<br />
   - Ouvrez le fichier :
     <div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/hosts.deny
</span></code></pre></div>
   - Recherchez et supprimez la ligne contenant l'IP bannie.</p>
</li>
<li>
<p><strong>Redémarrez PortSentry</strong> :
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>portsentry
</span></code></pre></div></p>
</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Débannir manuellement une IP peut être nécessaire si vous bloquez accidentellement une adresse autorisée, comme localhost.</p>
</div>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.tooltips", "navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.path", "navigation.sections"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>